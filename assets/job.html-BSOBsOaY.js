import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as p,d as n,o as i}from"./app-UKhqlS50.js";const e={};function c(l,s){return i(),p("div",null,s[0]||(s[0]=[n(`<h1 id="job" tabindex="-1"><a class="header-anchor" href="#job"><span>Job</span></a></h1><h2 id="普通-job" tabindex="-1"><a class="header-anchor" href="#普通-job"><span>普通 Job</span></a></h2><p>Job 会创建一个或多个 Pods，并将继续重试 Pods 的执行，直到指定数量的 Pods 成功终止。</p><p>下面是一个简单 Job 的示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-dark:#abb2bf;--shiki-light:#000000;--shiki-dark-bg:#282c34;--shiki-light-bg:#FFFFFF;"><pre class="shiki shiki-themes one-dark-pro light-plus vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">apiVersion</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">batch/v1</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">kind</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">Job</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">metadata</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">name</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">sms</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">namespace</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">example</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">spec</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">template</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">spec</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">imagePullSecrets</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">-</span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">name</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">myali-docker</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">containers</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">-</span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">name</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">sms</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">image</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">registry.cn-qingdao.aliyuncs.com/ppg007/cronjob-demo:1.0</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">command</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">-</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">./tencent-sms</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">restartPolicy</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">Never</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">backoffLimit</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#098658;">4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>job 中的 restartPolicy 只能设置为 Never 或 OnFailure。</p><p>backoffLimit 表示视 Job 为失败前的重试次数，默认情况下，Job 会持续运行，除非某个 Pod 失败（restartPolicy=Never）或者某个容器出错退出，Job 基于 backoffLimit 决定是否以及如何重试，一旦到达上限，Job 会被标记失败，其中运行的 Pods 都会被终止。</p><p>Job 完成时不会再创建新的 Pod，已有的 Pod 通常也不会被删除。可以通过 <code>.spec.activeDeadlineSeconds</code> 设置活跃期限，这是一个秒数值，无论 Job 创建了多少个 Pod，一旦 Job 运行时间到达活跃期限限制，其所有运行中的 Pod 都会被终止。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>活跃期限优先级高于 backoffLimit，如果一个 Job 正在重试一个或多个失效的 Pod，该 Job 一旦到达活跃期限，就不再部署额外的 Pod，即使重试次数还没到达 backoffLimit。</p></div><h3 id="自动清理完成的-job" tabindex="-1"><a class="header-anchor" href="#自动清理完成的-job"><span>自动清理完成的 Job</span></a></h3><p>可以通过 <code>.spec.ttlSecondsAfterFinished</code> 设置 Job 成功多少秒后被清除。</p><h2 id="使用-cronjob-运行定时任务" tabindex="-1"><a class="header-anchor" href="#使用-cronjob-运行定时任务"><span>使用 CronJob 运行定时任务</span></a></h2><p>通过下面这个配置文件创建一个 CronJob：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-dark:#abb2bf;--shiki-light:#000000;--shiki-dark-bg:#282c34;--shiki-light-bg:#FFFFFF;"><pre class="shiki shiki-themes one-dark-pro light-plus vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">apiVersion</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">batch/v1</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">kind</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">CronJob</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">metadata</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">name</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">hello</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">namespace</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">example</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">spec</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">schedule</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">&#39;*</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">*</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">*</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">*</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">*&#39;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">jobTemplate</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">spec</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">template</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">spec</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">imagePullSecrets</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">-</span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">name</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">myali-docker</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">containers</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">-</span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">name</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">hello</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">image</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">registry.cn-qingdao.aliyuncs.com/ppg007/cronjob-demo:1.0</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">imagePullPolicy</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">IfNotPresent</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">command</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">-</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">./tencent-sms</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-dark:#E06C75;--shiki-light:#800000;">restartPolicy</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">:</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#0000FF;">Never</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">注意</p><p>Job 名称和对应的 Pod 名称不同，Pod 名称可以通过 <code>kubectl get jobs --watch -n example</code> 看到，然后使用 <code>kubectl logs POD_NAME</code> 即可看到 Pod 日志。</p></div><h3 id="开始的最后期限" tabindex="-1"><a class="header-anchor" href="#开始的最后期限"><span>开始的最后期限</span></a></h3><p><code>spec.startingDeadlineSeconds</code> 域是可选的，任务如果由于某种原因错过了调度时间，开始该任务截止时间的秒数。过了截止时间 CronJob 就不会开始任务。</p><h3 id="并发性规则" tabindex="-1"><a class="header-anchor" href="#并发性规则"><span>并发性规则</span></a></h3><p><code>.spec.concurrencyPolicy</code> 声明了 CronJob 创建的任务执行时发生重叠如何处理，spec 仅能声明下列规则中的一种：</p><ul><li>Allow(默认)：CronJob 允许并发任务执行。</li><li>Forbin：CronJob 不允许并发执行任务，如果新任务的执行时间到了但是老任务还没有执行完毕，CronJob 会忽略新任务的执行。</li><li>Replace：如果新任务的执行时间到了而老任务没有执行完，CronJob 会用新任务替换当前正在运行的任务。</li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>并发性规则仅适用于相同 CronJob，如果有多个 CronJob，它们相应的任务总是允许并发执行。</p></div>`,21)]))}const k=a(e,[["render",c]]),d=JSON.parse('{"path":"/kubernetes/docs/job.html","title":"Job","lang":"zh-CN","frontmatter":{"description":"Job 普通 Job Job 会创建一个或多个 Pods，并将继续重试 Pods 的执行，直到指定数量的 Pods 成功终止。 下面是一个简单 Job 的示例： job 中的 restartPolicy 只能设置为 Never 或 OnFailure。 backoffLimit 表示视 Job 为失败前的重试次数，默认情况下，Job 会持续运行，除非某...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Job\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-05-13T01:18:18.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://ppg007.github.io/kubernetes/docs/job.html"}],["meta",{"property":"og:site_name","content":"PPG007 的文档"}],["meta",{"property":"og:title","content":"Job"}],["meta",{"property":"og:description","content":"Job 普通 Job Job 会创建一个或多个 Pods，并将继续重试 Pods 的执行，直到指定数量的 Pods 成功终止。 下面是一个简单 Job 的示例： job 中的 restartPolicy 只能设置为 Never 或 OnFailure。 backoffLimit 表示视 Job 为失败前的重试次数，默认情况下，Job 会持续运行，除非某..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-13T01:18:18.000Z"}],["meta",{"property":"article:modified_time","content":"2025-05-13T01:18:18.000Z"}]]},"git":{"createdTime":1649743406000,"updatedTime":1747099098000,"contributors":[{"name":"PPG007","username":"PPG007","email":"1658272229@qq.com","commits":1,"url":"https://github.com/PPG007"},{"name":"Koston Zhuang","username":"","email":"koston.zhuang@maiscrm.com","commits":1}]},"readingTime":{"minutes":2.21,"words":663},"filePathRelative":"kubernetes/docs/job.md","excerpt":"\\n<h2>普通 Job</h2>\\n<p>Job 会创建一个或多个 Pods，并将继续重试 Pods 的执行，直到指定数量的 Pods 成功终止。</p>","autoDesc":true}');export{k as comp,d as data};
