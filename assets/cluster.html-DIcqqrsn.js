import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as e,o as n}from"./app-UKhqlS50.js";const t="/assets/image-20210822183640441-idCQ_CUP.png",l={};function p(h,s){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="集群" tabindex="-1"><a class="header-anchor" href="#集群"><span>集群</span></a></h1><p>去中心化集群。</p><h2 id="集群搭建" tabindex="-1"><a class="header-anchor" href="#集群搭建"><span>集群搭建</span></a></h2><p>创建六个配置文件，每个文件端口号不同，且均作出如下配置：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-dark:#abb2bf;--shiki-light:#000000;--shiki-dark-bg:#282c34;--shiki-light-bg:#FFFFFF;"><pre class="shiki shiki-themes one-dark-pro light-plus vp-code"><code class="language-sh"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#795E26;">cluster-enabled</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#795E26;">cluster-config-file</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">nodes-6379.conf#这里的配置文件会自动生成，名字也要不同</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#795E26;">cluster-node-timeout</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#098658;">15000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分别启动六个 redis 进程，并确认启动成功且 nodes.conf 文件正确生成后执行命令：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-dark:#abb2bf;--shiki-light:#000000;--shiki-dark-bg:#282c34;--shiki-light-bg:#FFFFFF;"><pre class="shiki shiki-themes one-dark-pro light-plus vp-code"><code class="language-sh"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#795E26;">redis-cli</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#0000FF;">--cluster</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">create</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#0000FF;">--cluster-replicas</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#098658;">1</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">127.0.0.1:6379</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">127.0.0.1:6380</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">127.0.0.1:6381</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">127.0.0.1:6389</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">127.0.0.1:6390</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">127.0.0.1:6391</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>执行上述命令开启集群，不要使用域名。</p><p>成功后输出结果：</p><p><img src="`+t+'" alt="image-20210822183640441"></p><p>使用 redis-cli 添加 -c 参数，然后连接任意端口进程都能连接到进程中：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-dark:#abb2bf;--shiki-light:#000000;--shiki-dark-bg:#282c34;--shiki-light-bg:#FFFFFF;"><pre class="shiki shiki-themes one-dark-pro light-plus vp-code"><code class="language-sh"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#795E26;">redis-cli</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#0000FF;">-c</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#0000FF;">-p</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#098658;">6391</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>通过以下命令查看集群节点：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-dark:#abb2bf;--shiki-light:#000000;--shiki-dark-bg:#282c34;--shiki-light-bg:#FFFFFF;"><pre class="shiki shiki-themes one-dark-pro light-plus vp-code"><code class="language-sh"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#795E26;">127.0.0.1:6391</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#000000;">&gt;</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">cluster</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">nodes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>每个集群至少要有三个主节点。</p></div><h2 id="slots" tabindex="-1"><a class="header-anchor" href="#slots"><span>slots</span></a></h2><p>从结果图可知，redis 集群有 16384 个插槽，每个 redis 都对应一个插槽范围，操作数据时，根据 key 值计算出插槽位置，在任意的 redis 中，执行操作会重定向到 key 所在的插槽所在的 redis 实例。</p><h3 id="插入" tabindex="-1"><a class="header-anchor" href="#插入"><span>插入</span></a></h3><p>在集群中插入 map 时要指定一个组，例如：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-dark:#abb2bf;--shiki-light:#000000;--shiki-dark-bg:#282c34;--shiki-light-bg:#FFFFFF;"><pre class="shiki shiki-themes one-dark-pro light-plus vp-code"><code class="language-sh"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#795E26;">mset</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">name{user}</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">ppg</span><span class="space"> </span><span style="--shiki-dark:#98C379;--shiki-light:#A31515;">age{user}</span><span class="space"> </span><span style="--shiki-dark:#D19A66;--shiki-light:#098658;">20</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这样会根据 user 计算插槽值。</p><h2 id="故障恢复" tabindex="-1"><a class="header-anchor" href="#故障恢复"><span>故障恢复</span></a></h2><p>如果某段插槽的主从都挂掉,而 cluster-require-full-coverage 为 yes,那么,整个集群都挂掉。</p><p>如果臬段插槽的主从都挂掉,而 cluster-require-full-coverage 为 no,那么,该插槽数据全都不能使用,也无法存储</p>',24)]))}const d=i(l,[["render",p]]),k=JSON.parse('{"path":"/redis/docs/cluster.html","title":"集群","lang":"zh-CN","frontmatter":{"description":"集群 去中心化集群。 集群搭建 创建六个配置文件，每个文件端口号不同，且均作出如下配置： 分别启动六个 redis 进程，并确认启动成功且 nodes.conf 文件正确生成后执行命令： 执行上述命令开启集群，不要使用域名。 成功后输出结果： image-20210822183640441 使用 redis-cli 添加 -c 参数，然后连接任意端口进...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"集群\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2022-08-15T09:32:39.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://ppg007.github.io/redis/docs/cluster.html"}],["meta",{"property":"og:site_name","content":"PPG007 的文档"}],["meta",{"property":"og:title","content":"集群"}],["meta",{"property":"og:description","content":"集群 去中心化集群。 集群搭建 创建六个配置文件，每个文件端口号不同，且均作出如下配置： 分别启动六个 redis 进程，并确认启动成功且 nodes.conf 文件正确生成后执行命令： 执行上述命令开启集群，不要使用域名。 成功后输出结果： image-20210822183640441 使用 redis-cli 添加 -c 参数，然后连接任意端口进..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2022-08-15T09:32:39.000Z"}],["meta",{"property":"article:modified_time","content":"2022-08-15T09:32:39.000Z"}]]},"git":{"createdTime":1640699484000,"updatedTime":1660555959000,"contributors":[{"name":"PPG007","username":"PPG007","email":"1658272229@com请求","commits":1,"url":"https://github.com/PPG007"},{"name":"Koston Zhuang","username":"","email":"koston.zhuang@maiscrm.com","commits":1}]},"readingTime":{"minutes":1.28,"words":384},"filePathRelative":"redis/docs/cluster.md","excerpt":"\\n<p>去中心化集群。</p>\\n<h2>集群搭建</h2>\\n","autoDesc":true}');export{d as comp,k as data};
