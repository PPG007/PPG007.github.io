# JavaScript

## 基础

变量提升：JavaScript 在解析时，先解析代码，获取所有被声明的变量，然后一行一行的运行，但是只是将变量的声明提前了，如果变量声明时同时进行了赋值，那么赋值将依然在原位置运行，且必须是 `var` 关键字声明的变量才能进行变量提升。

switch 表达式与 case 后面的表达式比较时采用的是严格相等运算符 `===`。

标签：标签用在语句前面，相当于定位符，使用 `break` 和 `continue` 后添加标签名可以调到指定位置。

## 数据类型

### 概述

确定一个值是什么类型：

- typeof 运算符：

    ```js
    console.log(typeof '123');// string
    console.log(typeof 123);// number
    ```

- instanceof 运算符：

    instanceof 运算符返回一个布尔值，表示对象是否是某个构造函数的实例。运算符左边是实例对象，右边是构造函数，检查右边构造函数的原型对象是否在左边对象的原型链上，等价于 `Constructor.prototype.isPrototypeOf(instance)`。

- Object.prototype.toString 方法：

### 布尔值、null、undefined

null 在转换为数值时会转换为 0，undefined 会转换为 NaN。

布尔值转换规则：

下面这些内容会被转为 false：

- undefined。
- null。
- false。
- 0。
- NaN。
- "" 或 ''。

**注意：空数组、空对象都会转为 true。**

### 数值

JavaScript 中所有数字都是以 64 位浮点数形式储存，即使是整数。

关于 NaN：

- NaN 不是独立的数据类型，仍然是 number。
- NaN 不等于任何值，包括自己。
- NaN 与任何数运算得到的都是NaN。

一些与数值相关的全局方法：

- parseInt：将字符串转为整数。
    - 如果字符串头部有空格，空格会被自动去除。
    - 如果参数不是字符串则会先转换为字符串。
    - 转换时是一个个字符依次转换，如果遇到不能转为数字的字符，就不在进行下去，只返回已转好的部分。
    - parseInt 的返回值要么是一个十进制整数，要么是 NaN。
    - parseInt 可以接受第二个参数，表示被解析的值的进制，返回对应的十进制数。
- parseFloat：将一个字符串转为浮点数。
- isNaN：用来判断一个值是否为 NaN。此方法只对数值有效，如果传入其他值会被先转成数值，字符串会被转为 NaN 导致结果为 true。对于对象和数组同样返回 true，但是如果是空数组或者是只有一个数值成员的数组会返回 false。
- isFinite：返回一个布尔值，表示某个值是否为正常的数值。

### 字符串

Base64 转码：

- btoa()：任意值转为 Base64 编码。
- atob()：Base64 编码转为原来的值。

非 ASCII 码字符转为 Base64 编码中间必须插入一个转码环节。通过 `encodeURIComponent()` 进行编码，通过 `decodeURIComponent()` 进行解码。

在 Node.js 中无法使用 `btoa-atob` 两个方法，需要使用 `Buffer.from(str).toString('base64')` 将字符串转换为 Base64 编码，使用 `Buffer.from(str,'base64').toString()` 将 Base64 编码转为字符串。

### 对象

定义对象时，键加不加引号都可以，最后都会被转成字符串，如果键名不符合标识名的条件，例如第一个字符是数字，或者含有空格或运算符而且也不是数字，必须加引号。

如果不同的变量名指向同一个对象，那么它们都是这个对象的引用，指向同一块内存，修改一个变量，会影响所有变量；如果取消某个变量对于原对象的引用，不会影响到另一个变量。

查看一个对象本身的所有属性：`Object.keys` 方法。

删除对象的属性：`delete`，删除成功返回 true，如果删除一个不存在的属性也是返回 true。

属性是否存在：`in`，包含就返回 true，不包含就返回 false，但是这个运算符不会区分哪些属性是继承的，哪些是自己的。

判断是否是自身的属性：`hasOwnProperty`。

属性的遍历：使用 `for...in` 可以对属性进行遍历，它遍历的是对象所有可遍历的属性，会跳过不可遍历的属性。不仅遍历对象自身的属性，还遍历继承的属性，一般结合 `hasOwnProperties` 方法使用：

```javascript
for (const key in user) {
  if (user.hasOwnProperty(key)) {
    console.log(`键：${key}`)
    console.log(`值：${user[key]}`)
  }
}
```

with 语句：操作一个对象的多个属性时提供方便，如果在 with 语句块内部进行赋值操作，必须是对象已有的属性，否则会创造一个当前作用域的全局变量

### 函数

函数的声明：

- function 命令。
- 函数表达式：将函数匿名赋给一个变量，结尾要加分号。
- Function 构造函数。

函数的属性和方法：

- name 属性：返回函数的名字，如果是通过变量赋值定义的匿名函数，那么返回变量名。
- length 属性：返回函数预期传入的参数个数。
- toString()：返回一个字符串，内容是函数的源码。

参数的传递：如果参数是原始类型的值，传递方式是值传递，函数体内修改参数值不会影响到函数外部，如果参数是符合类型的值，传递方式是传址传递，传入的是原始值地址，如果函数体中修改对象、数组是整体替换那将不会影响原来的对象，因为只是修改了一个引用。

如果存在重名的参数，取最后的值。如果一个函数有两个重名参数，传入两个参数时，通过变量名只能获取第二个参数，如果传一个参数，则会变成 undefined。

arguments 对象：

这个对象包含了函数运行时的所有参数，可以通过下标对参数进行访问，这个对象只能在函数体内部使用，在严格模式下，修改 arguments 对象不会影响到实际的函数参数，通过 length 属性可以判断调用时带几个参数。

虽然这个对象看起来很像数组，但它是一个对象，数组专有的方法不能在这个对象上使用。

闭包：能够读取其他函数内部变量的函数，由于 JavaScript 的特点，这个函数就是一个函数的子函数，闭包将函数内部和函数外部连接起来一座桥梁。闭包使得内部变量记住上一次调用时的运算结果，每一次调用都是在上一次调用的基础上进行计算。闭包还可以封装对象的私有属性和私有方法。

### 数组

length 属性：如果认为扩大 length，那么新出来的位置上都是空的。

通过 `in` 运算符检查某个键名是否存在。

使用 `delete` 命令删除数组中的某个元素时，不会影响 length 属性，length 属性不过滤空位。

## 运算符

void 运算符：执行一个表达式，不返回任何值，或者说返回 undefined。

逗号运算符：用于对两个表达式求值，并返回另一个表达式的值。

## 语法

### 数据类型的转换

- Number() 函数：将任意类型的值转化为数值。这个函数比 parseInt 更加严格，只要有一个字符无法转换为数值，就会返回 NaN。
- String() 函数：将任意类型的值转化成字符串。
- Boolean() 函数：将任意类型的值转为布尔值，只有 undefined、null、0、NaN和空字符串会被转换成 false，所有对象的转换结果都是 true，包括 false 的布尔对象。

### 错误处理机制

Error 实例对象：所有抛出的错误都是这个构造函数的实例，`Error()` 构造函数接受一个参数表示错误提示。

throw 语句：手动中断程序执行，抛出一个错误。throw 可以抛出任何类型的值。

### console 对象与控制台

console 对象的静态方法：

- console.log()。
- console.info()。
- console.debug()。
- console.warn()。
- console.error()。

## 内置对象

### Array 对象

- push()、pop()：
    - push() 方法用于在数组的末端添加一个或多个元素，并返回添加新元素后的数组长度。
    - pop() 方法用于删除数组的最后一个元素并返回这个元素，对空数组会返回 undefined。
- shift()、unshift()：
    - shift() 方法用于删除数组的第一个元素并返回该元素。
    - unshift() 方法用于在数组的第一个位置添加元素并返回添加后的数组长度。
- join()：以指定参数作为分隔符，将所有数组成员连接成一个字符串返回，如果不提供参数，默认是逗号，如果数组成员是 undefined 或 null 或空位，会被转成空字符串。
- concat()：用于多个数组的合并，将新数组的成员添加到原数组成员的后部然后返回一个新数组，原数组不变，如果数组成员包括对象，concat 方法返回当前数组的一个浅拷贝。
- reverse()：颠倒排列数组元素，返回改变后的数组。
- slice()：用于提取目标数组的一部分，返回一个新数组，原数组不变，第一个参数为起始位置，包括在返回值中，第二个参数为终止位置，不包含在返回值中。
- splice()：删除原数组的一部分成员，并可以在删除的位置添加新的数组成员，返回值是被删除的元素，第一个参数是删除的起始位置，第二个参数是被删除的元素个数，后面的所有参数都是要被插入数组的元素。第一个参数如果是负数表示从后面开始计算。
- sort()：对数组成员进行排序，默认按照字典顺序排序，排序后原数组会被改变，可以通过为 sort 传入一个函数自定义排序方式，这个函数有两个参数。
- map()：将数组的所有成员依次传入参数函数，把每一次的执行结果组成一个新数组返回，map 会想这个函数传递当前成员、当前位置、数组本身。
- foreach()：传入一个函数做参数，该函数接受三个参数：当前元素、当前位置、整个数组。foreach 方法可以接受第二个参数绑定参数函数的 this 变量；foreach 方法无法终端执行；foreach 方法会跳过数组的空位，但不会跳过 undefined 和 null。
- filter()：用于过滤数组成员，满足条件的成员组成一个新数组返回。接受一个函数做参数，函数有一个当前元素值的参数，filter 可以接受第二个参数用来绑定参数函数内部的 this 变量。
- some()、every()：
    - 都接受一个函数作为参数，所有数组成员依次执行该函数，这个函数接受三个参数：当前成员、当前位置、整个数组，返回一个布尔值。
    - some 方法只要一个成员的返回值是 true，整体就返回 true。
    - every 方法只要一个成员的返回值是 false，整体就返回 false。
    - 对于空数组，some 方法返回 false，every 方法返回 true。
    - 都可以接受第二个参数绑定函数内部的 this 变量。
- indexOf()、lastIndexOf()：
    - indexOf 方法返回给定元素在数组中第一次出现的位置，如果没有就返回 -1，可以接受第二个参数表示搜索开始的位置。
    - lastIndexOf 方法返回给定元素在数组中最后一次出现的位置，没有就返回 -1.
    - 这两个方法不能用来搜索 NaN 的位置。
- reduce()、reduceRight()：
    - 依次处理数组的每个成员最终累计为一个值，reduce 从左往右处理，reduceRight 从右往左处理。
    - 第一个参数是一个函数，该函数接受四个参数：
        - 累积变量：第一次执行时默认为数组第一个成员，以后每次执行都是上一轮的返回值。
        - 当前变量：第一次执行时，默认为数组的第二个成员，以后每次执行都是下一个成员。
        - 当前位置。
        - 原数组。

### String 对象

- concat() 方法：用于连接两个字符串，返回一个新字符串，不改变原字符串。
- slice() 方法：从原字符串取出子字符串并返回。
- substring() 方法：从原字符串取出子字符串并返回。
- indexOf()：返回一个字符串在另一个字符串中第一次出现的位置。
- lastIndexOf()：从尾部开始匹配，第二个参数表示从该位置向前匹配。
- trim()：去除字符串两端的空格，返回一个新字符串。
- toLowerCase()、toUpperCase()：将一个字符串全部转为小写或大写。
- match()：确定原字符串是否匹配某个子字符串，返回一个数组，成员为匹配的第一个字符串，如果没有找到匹配就返回 null。返回的数组还有 index 属性和 input 属性，分别表示匹配字符串开始的位置和原始字符串。
- search()、replace()：search 方法与 match 类似，返回值为匹配的第一个位置，如果没有匹配就返回 -1；replace 方法用于替换匹配的子字符串，一般情况下只替换第一个匹配。
- split()：分隔字符串。

### Math 对象

- abs()：返回参数的绝对值。
- max()、min()：返回参数中的最大最小值。
- floor()、ceil()：返回小于等于参数值的最大整数、返回大于或等于参数值的最小整数。
- round()：四舍五入
- pow()：返回以第一个参数为底数、第二个参数为指数的幂运算值。
- sqrt()：返回参数的平方根。
- log()：返回以 e 为底的自然对数值。
- exp()：返回常数 e 的参数次方。
- random()：返回大于等于 0，小于 1 的一个伪随机数。

### JSON 对象

- JSON.stringify()：将一个值转为 JSON 字符串。
- JSON.parse()：将 JSON 字符串转换为对应的值。

## 面向对象编程

### 实例对象与 new 命令

new 命令的工作流程：

- 创建一个空对象，作为要返回的对象实例。
- 将这个空对象的原型指向构造函数的 prototype 属性。
- 将这个空对象赋值给函数内部的 this 关键字。
- 开始执行构造函数内部的代码。

如果构造函数内部存在 return 语句，而且返回的是一个对象，new 命令会返回 return 指定的对象，否则就会不管 return 语句而返回 this。

函数内部可以使用 `new.target` 属性，如果当前函数是 new 命令调用，这个属性会指向当前函数，否则返回 undefined。

如果希望从现有对象作为模板创建新的实例对象可以使用 `Object.create()` 方法。

### this 关键字

this 就是属性或方法“当前”所在的对象。

内层的 this 不指向外部，而是指向顶层对象。

this 的几个使用场合：

- 全局环境，指向顶层对象 window。
- 构造函数，指的是实例对象。
- 对象的方法，指的是方法运行时所在的对象

注意点：

- 避免多层 this，使用一个变量固定 this 的值然后内层函数调用这个变量。
- 避免数组处理方法中的 this。
- 避免回调函数中的 this。

绑定 this 的方法：

- 函数实例 call 方法，传入一个对象做参数，如果参数为空、null 或 undefined，则默认传入全局对象；如果参数是一个原始值则会转成包装对象，然后再传入 call 方法。call 方法可以接受多个参数，第一个参数做 this，后面的参数是函数调用时的参数。
- 函数实例 apply 方法，第一个参数是 this 的指向，如果设为 null 或 undefined 等同于全局对象；第二个参数是一个数组，该数组的成员依次传入原函数。
- 函数实例的 bind 方法，将函数体内的 this 绑定到某个对象然后返回一个新函数，参数就是所要绑定 this 的对象，可以接受更多参数绑定原函数的参数。

### 对象的继承

原型对象 prototype：

每个原型对象都有一个 prototype 属性，指向一个对象，对于构造函数，生成实例的时候，该属性会自动成为实例对象的原型。

原型对象的作用就是定义所有实例对象共享的属性和方法，实例对象可以看作从原型对象衍生出来的子对象。

修改原型对象时一般要同时修改 constructor 属性的指向，指向原来的构造函数。

继承的步骤：

- 在子类构造函数中调用父类的构造函数。

    ```javascript
    function Dog(name) {
    Animal.call(this,name)
    }
    ```

- 让子类的原型指向父类的原型

    ```javascript
    Dog.prototype = Object.create(Animal.prototype)
    Dog.prototype.constructor = Dog
    ```

或者直接将子类的原型对象指向一个父类实例。

### Object 对象的相关方法

- Object.getPrototypeOf()：返回参数对象的原型。
- Object.setPrototypeOf()：为参数对象设置原型，返回该参数对象，接受两个参数，第一个是现有对象，第二个是原型对象。
- Object.create()：通过一个现有的实例对象生成另一个实例对象。
- isPrototypeOf()：判断一个对象是否是参数对象的原型。
- `__proto__`：返回一个对象的原型，可读可写。
- getOwnPropertyNames()：返回一个数组，成员是参数对象本身的所有属性的键名，不包含继承的键名。
- hasOwnProperty()：返回一个布尔值，用于判断某个属性定义在对象自身还是定义在原型链上。

## 异步操作

### 定时器

- setTimeout()：用来指定某个函数或某段代码，在多少毫秒之后执行，返回一个整数，表示定时器的编号，以后可以用来取消这个定时器。接受两个参数，第一个参数是要推迟执行的函数名或一段代码，第二个参数是推迟执行的毫秒数；还可以传入更多参数，它们将依次传入推迟执行的函数。
- setInterval()：指定某个任务每隔一段时间就执行依次，无限次定时运行。
- clearTimeout()、clearInterval()：将 setTimeout() 和 setInterval() 的返回值传入这两个方法中就可以取消对应的计时器。

## 事件

### EventTarget 接口

- addEventListener()：用于当前节点或对象上，添加一个事件监听器，这个函数接受三个参数：
    - type：事件名称，大小写敏感。
    - listener：监听函数，事件发生时会被调用。
    - 一个监听器配置对象，该对象有以下属性：
        - capture：布尔值，设为 true 表示监听函数在捕获阶段就会触发，默认值为 false，在冒泡阶段触发。
        - once：布尔值，如果设置为 true，表示监听函数执行一次就会自动移除，默认为 false。
        - passive：布尔值，设为 true 时表示禁止监听函数调用 `preventDefault()` 方法，默认为 false。
        - signal：属性值为一个 AbortSignal 对象，为监听器设置了一个信号通道，用来在需要时发出信号，移除监听函数。
- removeEventListener()：移除添加的事件监听函数，接受的参数和 addEventListener() 一致，但是不能取消匿名函数的监听。
- dispatchEvent()：在当前节点上触发指定事件，从而触发监听函数的执行，参数是一个 Event 对象实例。

### 事件模型

事件的传播：

一个事件发生后，会在子元素和父元素之间传播，这个传播分为三个阶段：

- 从 window 对象传导到目标节点，称为*捕获阶段*。
- 在目标节点上触发，称为*目标阶段*。
- 从目标节点传导会 window 对象，称为*冒泡阶段*。

事件的代理：

由父节点的监听函数同一处理多个子元素的事件称为事件的代理。

如果希望事件到某个节点为止不再传播，可以使用事件对象的 `event.stopPropagation()`  方法阻止事件的传播。

如果想要彻底取消一个事件，使用 `stopImmediatePropagation()` 方法。

### Event 对象

Event 构造函数接受两个参数：

- 第一个参数 type 是字符串表示事件的名称。
- 第二个参数 options 是一个对象，表示事件对象的配置：
    - bubbles：布尔值，可选，默认 false，表示事件对象是否冒泡。
    - cancelable：布尔值，可选，默认 false，表示事件是否可以被取消，即 `Event.preventDefault()`。

实例方法：

- Event.preventDefault()：取消浏览器对当前事件的默认行为，前提是事件对象的 cancelable 属性为 true，此方法知识取消事件对当前元素的默认影响，不会阻止事件的传播。
- Event.stopPropagation()：阻止事件继续传播，防止再触发定义在别的节点上的监听函数，不包括在当前节点上其他事件监听函数。
- Event.stopImmediatePropagation()：阻止同一个事件的其他监听函数被调用，不管监听函数定义在当前节点还是其他节点。
- Event.composedPath()：返回一个数组，成员是事件的最底层节点和依次冒泡所经过的所有上层节点。

## 浏览器模型

defer 属性：为了解决脚本文件下载阻塞网页渲染，在 script 元素加入 defer 属性，等到 DOM 加载生成后再执行脚本。

async 属性：为 script 元素加入 async 属性，使用另一个进程下载脚本，下载时不会阻塞渲染。但是无法控制脚本的执行顺序，那个先下载结束就先执行。

如果脚本之间没有依赖关系，就使用 async 属性，如果脚本之间存在依赖关系就使用 defer 属性。
